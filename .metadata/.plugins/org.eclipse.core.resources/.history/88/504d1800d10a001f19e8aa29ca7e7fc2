package com.pbl3.service;

import java.sql.Connection;
import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.LinkedList;

import com.pbl3.libs.Pair;
import com.pbl3.model.CouponModel;
import com.pbl3.model.Coupon_CourseModel;

public class Coupon_CourseService extends BaseService{
    public static void add(Coupon_CourseModel coupon_CourseModel) {
        try {
            Connection connection = getConnection();
            PreparedStatement preparedStatement = connection.prepareStatement("INSERT INTO coupon_course (courseID, couponID) VALUES (?, ?)");
            preparedStatement.setInt(1, coupon_CourseModel.getCourseID());
            preparedStatement.setInt(2, coupon_CourseModel.getCouponID());
            preparedStatement.executeUpdate();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    
    public static void delete(Coupon_CourseModel coupon_CourseModel) {
        try {
            Connection connection = getConnection();
            PreparedStatement preparedStatement = connection.prepareStatement("DELETE FROM coupon_course WHERE CouponID = ? AND course = ?");
            preparedStatement.setInt(1, coupon_CourseModel.getCouponID());
            preparedStatement.setInt(2, coupon_CourseModel.getCourseID());
            preparedStatement.executeUpdate();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    
    public static LinkedList<Pair<CouponModel, Integer>> all() {
        LinkedList<CouponModel> couponModels = new LinkedList<>();
        try {
            Connection connection = getConnection();
            PreparedStatement preparedStatement = connection.prepareStatement("SELECT * FROM coupon ORDER BY CouponID DESC;");
            ResultSet resultSet = preparedStatement.executeQuery();
            while (resultSet.next()) {
                int couponID = resultSet.getInt(1); 
                String code = resultSet.getString(2);
                Date startDate = resultSet.getDate(3); 
                Date endDate = resultSet.getDate(4);
                int quantity = resultSet.getInt(5);
                int quantityUsed = resultSet.getInt(6);
                int percent = resultSet.getInt(7);
                CouponModel couponModel = new CouponModel(couponID, code, startDate, endDate, quantity, quantityUsed, percent);
                couponModels.add(couponModel);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return couponModels;
    }
}
