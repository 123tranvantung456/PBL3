package com.pbl3.controller.admin;

import java.io.IOException;
import java.util.LinkedList;

import com.pbl3.libs.MD5;
import com.pbl3.model.AccountModel;
import com.pbl3.model.UserModel;
import com.pbl3.service.AccountService;
import com.pbl3.service.UserService;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@WebServlet(urlPatterns = { "/admin/users", "/admin/users/create", "/admin/users/edit", "/admin/users/delete" })
public class UserController extends HttpServlet {
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi doGet UserController - admin");
		String actionString = req.getServletPath();
		System.out.println("actionstring la: "+actionString);
		switch (actionString) {
		case "/admin/users": {
			System.out.println("goi doget /admin/users");
			show(req, resp);
			break;
		}
		case "/admin/users/create" : {
			System.out.println("goi doget /admin/users/create");
			create(req, resp);
			break;
		}
		
		case "/admin/users/edit" : {
			System.out.println("goi doget /admin/users/edit");
			break;
		} 
		
		case "/admin/users/delete" : {
			System.out.println("goi doget /admin/users/delete");
			break;
		}
		}
	}
	protected void show(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham show");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/users.jsp");
		LinkedList<UserModel> userModels = UserService.all();
		req.setAttribute("userModels", userModels);
		requestDispatcher.forward(req, resp); 
	}
	
	protected void create(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/create-users.jsp");
		requestDispatcher.forward(req, resp); 
	}
	
	protected void edit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/edit-users.jsp");
		requestDispatcher.forward(req, resp); 
	}
	
	protected void delete(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/delete-users.jsp");
		requestDispatcher.forward(req, resp); 
	}
	
	protected void createSubmit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		String userName = req.getParameter("username");
		String password = MD5.getMD5(req.getParameter("password"));
		int roleID = Integer.parseInt(req.getParameter("roleID"));
		AccountModel accountModel = new AccountModel(roleID, userName, password);
		int accountID = AccountService.add(accountModel);
		System.out.println("acc vua them co accountID: " + accountID);
		String name = req.getParameter("name");
		String email = req.getParameter("email");
		String phone = req.getParameter("phone");
		Boolean gender = Boolean.parseBoolean(req.getParameter("gender"));
		UserModel userModel = new UserModel(accountID, name, phone, email, gender);
		UserService.add(userModel);
	}
	
	protected void editSubmit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/edit-users.jsp");
		requestDispatcher.forward(req, resp); 
	}
	
	protected void deleteSubmit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi ham create");
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/admin/users/delete-users.jsp");
		requestDispatcher.forward(req, resp); 
	}
	
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi doPost UserController - admin");
		String actionString = req.getServletPath();
		System.out.println("actionstring la: "+actionString);
		switch (actionString) {
		case "/admin/users/create" : {
			System.out.println("goi doget /admin/users/create");
			createSubmit(req, resp);
			break;
		}
		
		case "/admin/users/edit" : {
			System.out.println("goi doget /admin/users/edit");
			editSubmit(req, resp);
			break;
		} 
		
		case "/admin/users/delete" : {
			System.out.println("goi doget /admin/users/delete");
			deleteSubmit(req, resp);
			break;
		}
		}
	}
}