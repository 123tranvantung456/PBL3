package com.pbl3.service;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import com.pbl3.model.AccountModel;
import com.pbl3.model.UserModel;

public class UserService extends BaseService{
	// them nguoi dung
		public static void add(UserModel userModel) {
			try {
				Connection connection = getConnection();
				PreparedStatement preparedStatement = connection.prepareStatement("INSERT INTO user (AccountID, Name, Phone, Gmail, Gender) VALUES (?, ?, ?, ?, ?)"); 
				preparedStatement.setInt(1, userModel.getAccountID());
				preparedStatement.setString(2, userModel.getName());
				preparedStatement.setString(3, userModel.getPhone());
				preparedStatement.setString(4, userModel.getEmail());
				preparedStatement.setBoolean(5, userModel.getGender());
				preparedStatement.executeUpdate();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
		// dang nhap
		// truy van ra trong data base account vua dang nhap, ko co thi tra ve 1 UserModel voi UserModel = 0 
		//co thi tra ve accountModel do 
		public static UserModel login(String usernameString, String passwordString) {
			UserModel userModel = new UserModel();
			try {
				Connection connection = getConnection();
				PreparedStatement preparedStatement = connection.prepareStatement("SELECT user.*  FROM user INNER JOIN account ON user.accountID = account.accountID WHERE account.username = ? AND account.password = ?"); 
				preparedStatement.setString(1, usernameString);
			    preparedStatement.setString(2, passwordString);
				ResultSet resultSet = preparedStatement.executeQuery();
				if(resultSet.next()) {
					int accountID = resultSet.getInt(1);
					int RoleID = resultSet.getInt(2);
					String userName = resultSet.getString(3);
					String password = resultSet.getString(4);
					
					accountModel.setUserName(userName);
					accountModel.setAccountID(accountID);
					accountModel.setRoleID(RoleID);
					accountModel.setPassword(password);
				}
			} catch (SQLException e) {
				e.printStackTrace();
			}
			return accountModel;
		}
}
