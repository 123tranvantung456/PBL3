package com.pbl3.controller.student;

import java.io.IOException;
import java.util.LinkedList;

import com.pbl3.model.UserModel;
import com.pbl3.model.VocabListsModel;
import com.pbl3.service.VocabListsService;
import com.pbl3.service.VocabService;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;

@WebServlet (urlPatterns = {"/vocab-lists", "/vocab-lists/create", "/vocab-lists/edit", "/vocab-lists/delete"})
public class VocabListsController extends HttpServlet{
	
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		
		String actionString = req.getServletPath();
		switch(actionString) {
			
			case "/vocab-lists" :{
				System.out.println("goi doGet ListsVocab user -> create-lists");
				HttpSession session = req.getSession();
				System.out.println("goi doGet ListsVocab user");
				UserModel userModel = (UserModel)session.getAttribute("user");
				int userID = userModel.getUserID();
				System.out.println("user vao chuc nang nay co id la: " +userID);
				LinkedList<VocabListsModel> vocabListsModels = VocabListsService.all(userID);
				req.setAttribute("vocabListsModels", vocabListsModels);
				RequestDispatcher reqDispatcher = req.getRequestDispatcher("views/student/vocab-lists/vocab-lists.jsp");
				reqDispatcher.forward(req, resp);
				break;
			}
		
			case "/vocab-lists/create" : {
				System.out.println("goi doGet ListsVocab user -> create-vocab-lists");
				create(req, resp);
				break;
			}
			
			case "/vocab-lists/edit" : {
				System.out.println("goi doGet ListsVocab user -> edit-vocab-lists");
				edit(req, resp);
				break;
			}
			
			case "/vocab-lists/delete" :{
				System.out.println("goi doGet ListsVocab user -> delete-vocab-lists");
				delete(req, resp);
				break;
			}
		}
	}
	
	// create
	protected void create(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("ham edit ListsVocab duoc goi");
		RequestDispatcher reqDispatcher = req.getRequestDispatcher("/vocab-lists");
	}
	
	// edit
	protected void edit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("ham edit ListsVocab duoc goi");
		int listID = Integer.parseInt(req.getParameter("listID"));
//		int userID = Integer.parseInt(req.getParameter("userID"));
//		Integer courseID = Integer.parseInt(req.getParameter("courseID"));
		String nameList = req.getParameter("nameList");
		String description = req.getParameter("description");
		VocabListsModel vocabListsModel = new VocabListsModel(listID, 0, 0, nameList, description);
		VocabListsService.edit(vocabListsModel);
		resp.sendRedirect(req.getContextPath() + "/vocab-lists");
	}
	
	// delete
	protected void delete(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("ham delete ListsVocab duoc goi");
		int listID = Integer.parseInt(req.getParameter("listID"));
		System.out.println("listID la: " + req.getParameter("listID"));
		VocabListsService.delete(listID);
		resp.sendRedirect(req.getContextPath() + "/vocab-lists");
	}
	
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String actionString = req.getServletPath();
		switch(actionString) {
			
			case "/vocab-lists" :{
				HttpSession session = req.getSession();
				System.out.println("goi doPost ListsVocab user");
				String nameList = req.getParameter("name");
				String description = req.getParameter("desc");
				UserModel userModel = (UserModel)session.getAttribute("user");
				int userID = userModel.getUserID();
				VocabListsModel vocabListsModel = new VocabListsModel(userID, null, nameList, description);
				VocabListsService.add(vocabListsModel);
//				System.out.println("them thanh cong");
				resp.sendRedirect(req.getContextPath()+"/vocab-lists");
				break;
			}
		
			case "/vocab-lists/create" : {
				System.out.println("goi doPost ListsVocab user -> create-vocab-lists");
				create(req, resp);
				break;
			}
			
			case "/vocab-lists/edit" : {
				edit(req,resp);
				break;
			}
			
			case "/vocab-lists/delete" :{
				
				break;
			}
		}
	}
	
}
