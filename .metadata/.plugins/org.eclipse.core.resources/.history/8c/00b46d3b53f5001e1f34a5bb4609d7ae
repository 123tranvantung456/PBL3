package com.pbl3.controller.student;

import java.io.IOException;
import java.util.LinkedList;

import com.pbl3.model.VocabListsModel;
import com.pbl3.model.VocabModel;
import com.pbl3.service.VocabListsService;
import com.pbl3.service.VocabService;

import jakarta.servlet.RequestDispatcher;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@WebServlet (urlPatterns = {"/vocab-lists/vocab", "/vocab-lists/vocab/create", "/vocab-lists/vocab/review", "/vocab-lists/vocab/delete", "/vocab-lists/vocab/edit"})
public class VocabController extends HttpServlet{
	@Override
	protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		String actionString = req.getServletPath(); // lay phan sau: vi du link http://localhost:8080/MVC/vocab-lists/vocab/review
		// thi se lay dc : /vocab-lists/vocab/review
		System.out.println("actionString tai do get la: " + actionString);
		switch(actionString) {
			case "/vocab-lists/vocab/review" : {
				System.out.println("goi case /vocab-lists/vocab/review - doget");
				review(req, resp);
				break;
			}
			
			case "/vocab-lists/vocab/delete" : {
				System.out.println("goi case /vocab-lists/vocab/delete - doget");
				delete(req, resp);
				break;
			}
			
			
			case "/vocab-lists/vocab" : {
				System.out.println("goi do get vocab-lists/vocab");
				int listID = Integer.parseInt(req.getParameter("listID"));
				LinkedList<VocabModel> vocabModels = VocabService.all(listID);
				for(VocabModel vocabModel :  vocabModels) {
					System.out.println(vocabModel.getVocabID());
				}
				req.setAttribute("listID", listID);
				req.setAttribute("vocabModels", vocabModels);
				RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/student/vocab-lists/vocab/vocab.jsp");
				requestDispatcher.forward(req, resp);
				break;
			}
		}	
	}
	
	// create
	public void create(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException{
		int listID = Integer.parseInt(req.getParameter("listID"));
		System.out.println(listID);
		String vocab = req.getParameter("vocab");
		String mean = req.getParameter("mean");
		String wordType = req.getParameter("wordType"); 
		String example = req.getParameter("example");
		VocabModel vocabModel = new VocabModel(listID, vocab, mean, wordType, example);
		VocabService.add(vocabModel);
		doGet(req, resp);
	}
	
	// review
	public void review(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException{
		int listID = Integer.parseInt(req.getParameter("listID"));
		LinkedList<VocabModel> vocabModels = VocabService.all(listID);
		req.setAttribute("listID", listID);
		req.setAttribute("vocabModels", vocabModels);
		RequestDispatcher requestDispatcher = req.getRequestDispatcher("/views/student/vocab-lists/vocab/review.jsp");
		requestDispatcher.forward(req, resp);
	}
	
	// dang sua
	//delete
	protected void delete(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		int vocabID = Integer.parseInt(req.getParameter("vocabID"));
		System.out.println("listID la: " + req.getParameter("listID"));
		VocabService.delete(vocabID);
//		doGet(req, resp);
	}
	// dang sua
	// edit
	protected void edit(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		VocabModel vocabModel = VocabService.find(Integer.parseInt(req.getParameter("vocabID")));
		
	}
	
	@Override
	protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
		System.out.println("goi do post vocab-lists/vocab");
		String actionString = req.getServletPath(); 
		System.out.println("actionString tai do post la: " + actionString);
		switch (actionString) {
		
		case "/vocab-lists/vocab/create" : {
			System.out.println("goi /vocab-lists/vocab/create");
			create(req, resp);
			break;
		}
		
		case "/vocab-lists/vocab/edit" : {
			System.out.println("goi /vocab-lists/vocab/edit");
			delete(req, resp);
			break;
		    }
		}
	}
}
